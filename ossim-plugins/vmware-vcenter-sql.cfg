# Alienvault plugin
# Author: Alienvault Team at plugins@alienvault.com
# Plugin vmware-vcenter-sql id:90007 version: 0.0.5
# Last modification: 2017-04-10 13:40
#
# Plugin Selection Info:
# VMware:vCenter:MSSQL
#
# END-HEADER
# Accepted products:
# vmware - vcenter_converter -
# Description:
# 
#
#
[DEFAULT]
plugin_id=90007

[config]
type=detector
enable=yes

source=database
source_type=mssql
source_ip=vcenter_ip
source_port=1433
user="vcenter_user"
password="vcenter_pass"
db=vcenter_db
sleep=60

process=
start=no
stop=no

[translation]
com.vmware.license.AddLicenseEvent=1
com.vmware.license.AssignLicenseEvent=2
com.vmware.license.LicenseExpiryEvent=3
com.vmware.vc.cim.CIMGroupHealthStateChanged=4
com.vmware.vc.HA.ClusterFailoverActionCompletedEvent=5
com.vmware.vc.HA.ClusterFailoverActionInitiatedEvent=6
com.vmware.vc.HA.DasAgentRunningEvent=7
com.vmware.vc.HA.DasHostFailedEvent=8
com.vmware.vc.HA.DasTotalClusterFailureEvent=9
com.vmware.vc.HA.HostDasAgentHealthyEvent=10
com.vmware.vc.HA.HostDasErrorEvent=11
com.vmware.vc.VCHealthStateChangedEvent=12
esx.clear.net.connectivity.restored=13
esx.clear.net.redundancy.restored=14
esx.clear.net.vmnic.linkstate.up=15
esx.clear.storage.connectivity.restored=16
esx.clear.storage.redundancy.restored=17
esx.problem.net.connectivity.lost=18
esx.problem.net.redundancy.degraded=19
esx.problem.net.redundancy.lost=20
esx.problem.storage.connectivity.lost=21
esx.problem.storage.redundancy.degraded=22
esx.problem.storage.redundancy.lost=23
esx.problem.vmfs.heartbeat.recovered=24
esx.problem.vmfs.heartbeat.timedout=25
vim.event.AlarmActionTriggeredEvent=26
vim.event.AlarmCreatedEvent=27
vim.event.AlarmReconfiguredEvent=28
vim.event.AlarmSnmpCompletedEvent=29
vim.event.AlarmStatusChangedEvent=30
vim.event.BadUsernameSessionEvent=31
vim.event.ClusterComplianceCheckedEvent=32
vim.event.ClusterCreatedEvent=33
vim.event.ClusterReconfiguredEvent=34
vim.event.CustomFieldDefAddedEvent=35
vim.event.CustomFieldValueChangedEvent=36
vim.event.DasAdmissionControlDisabledEvent=37
vim.event.DasAgentFoundEvent=38
vim.event.DasAgentUnavailableEvent=39
vim.event.DasHostIsolatedEvent=40
vim.event.DatacenterCreatedEvent=41
vim.event.DatacenterRenamedEvent=42
vim.event.DatastoreDestroyedEvent=43
vim.event.DatastoreDiscoveredEvent=44
vim.event.DatastoreFileMovedEvent=45
vim.event.DatastoreRemovedOnHostEvent=46
vim.event.DatastoreRenamedEvent=47
vim.event.DrsVmMigratedEvent=48
vim.event.DrsVmPoweredOnEvent=49
vim.event.EnteredMaintenanceModeEvent=50
vim.event.EnteringMaintenanceModeEvent=51
vim.event.ExitMaintenanceModeEvent=52
vim.event.FailoverLevelRestored=53
vim.event.GeneralHostErrorEvent=54
vim.event.GeneralUserEvent=55
vim.event.GlobalMessageChangedEvent=56
vim.event.HealthStatusChangedEvent=57
vim.event.HostAddedEvent=58
vim.event.HostComplianceCheckedEvent=59
vim.event.HostCompliantEvent=60
vim.event.HostConfigAppliedEvent=61
vim.event.HostConnectedEvent=62
vim.event.HostConnectionLostEvent=63
vim.event.HostDasDisabledEvent=64
vim.event.HostDasDisablingEvent=65
vim.event.HostDasEnablingEvent=66
vim.event.HostDasOkEvent=67
vim.event.HostDisconnectedEvent=68
vim.event.HostIpChangedEvent=69
vim.event.HostIsolationIpPingFailedEvent=70
vim.event.HostNonCompliantEvent=71
vim.event.HostRemovedEvent=72
vim.event.HostWwnChangedEvent=73
vim.event.InsufficientFailoverResourcesEvent=74
vim.event.MigrationResourceWarningEvent=75
vim.event.NoAccessUserEvent=76
vim.event.PermissionAddedEvent=77
vim.event.PermissionRemovedEvent=78
vim.event.PermissionUpdatedEvent=79
vim.event.ProfileAssociatedEvent=80
vim.event.ProfileCreatedEvent=81
vim.event.ProfileDissociatedEvent=82
vim.event.ProfileReferenceHostChangedEvent=83
vim.event.ProfileRemovedEvent=84
vim.event.ResourcePoolCreatedEvent=85
vim.event.ResourcePoolReconfiguredEvent=86
vim.event.RoleAddedEvent=87
vim.event.RoleUpdatedEvent=88
vim.event.ScheduledTaskCreatedEvent=89
vim.event.ScheduledTaskRemovedEvent=90
vim.event.ServerStartedSessionEvent=91
vim.event.TaskEvent=92
vim.event.UserLoginSessionEvent=93
vim.event.UserLogoutSessionEvent=94
vim.event.VcAgentUpgradedEvent=95
vim.event.VimAccountPasswordChangedEvent=96
vim.event.VmAcquiredTicketEvent=97
vim.event.VmBeingClonedEvent=98
vim.event.VmBeingCreatedEvent=99
vim.event.VmBeingDeployedEvent=100
vim.event.VmBeingHotMigratedEvent=101
vim.event.VmBeingRelocatedEvent=102
vim.event.VmClonedEvent=103
vim.event.VmConnectedEvent=104
vim.event.VmCreatedEvent=105
vim.event.VmDasBeingResetEvent=106
vim.event.VmDeployedEvent=107
vim.event.VmDisconnectedEvent=108
vim.event.VmDiscoveredEvent=109
vim.event.VmEmigratingEvent=110
vim.event.VmFailedMigrateEvent=111
vim.event.VmFailoverFailed=112
vim.event.VMFSDatastoreCreatedEvent=113
vim.event.VmGuestRebootEvent=114
vim.event.VmGuestShutdownEvent=115
vim.event.VmHealthMonitoringStateChangedEvent=116
vim.event.VmInstanceUuidAssignedEvent=117
vim.event.VmInstanceUuidChangedEvent=118
vim.event.VmMacAssignedEvent=119
vim.event.VmMacChangedEvent=120
vim.event.VmMacConflictEvent=121
vim.event.VmMaxRestartCountReached=122
vim.event.VmMessageEvent=123
vim.event.VmMessageWarningEvent=124
vim.event.VmMigratedEvent=125
vim.event.VmPoweredOffEvent=126
vim.event.VmPoweredOnEvent=127
vim.event.VmPowerOffOnIsolationEvent=128
vim.event.VmReconfiguredEvent=129
vim.event.VmRegisteredEvent=130
vim.event.VmRelocatedEvent=131
vim.event.VmRemoteConsoleConnectedEvent=132
vim.event.VmRemoteConsoleDisconnectedEvent=133
vim.event.VmRemovedEvent=134
vim.event.VmRenamedEvent=135
vim.event.VmResettingEvent=136
vim.event.VmResourcePoolMovedEvent=137
vim.event.VmResourceReallocatedEvent=138
vim.event.VmRestartedOnAlternateHostEvent=139
vim.event.VmStartingEvent=140
vim.event.VmStoppingEvent=141
vim.event.VmUpgradeCompleteEvent=142
vim.event.VmUpgradingEvent=143
vim.event.VmUuidAssignedEvent=144
vim.event.VmUuidChangedEvent=145


[start_query]
query="select top 1 event_id from vmw.VPX_EVENT order by event_id DESC"
regexp=

[query]
query="Select EVENT_ID, EVENT_TYPE, CREATE_TIME, USERNAME, CATEGORY, VM_ID, VM_NAME, HOST_ID, HOST_NAME, COMPUTERESOURCE_ID, COMPUTERESOURCE_TYPE, COMPUTERESOURCE_NAME, DATACENTER_ID, DATACENTER_NAME, DATASTORE_ID, DATASTORE_NAME, NETWORK_ID, NETWORK_NAME, NETWORK_TYPE, DVS_ID, DVS_NAME, CHANGE_TAG_ID FROM vmw.VPX_EVENT WHERE event_id > $1 order by EVENT_ID"
regexp=
ref=0
plugin_sid={translate($1)}
date={normalize_date($2)}
device={$8}
src_ip={$6}
username={$3}
userdata1=EVENT_TYPE: {$1}, CREATE_TIME: {$2}, USERNAME: {$3}, CATEGORY: {$4}, VM_ID: {$5}, VM_NAME: {$6}, HOST_ID, HOST_NAME: {$7}, COMPUTERESOURCE_ID: {$8}, COMPUTERESOURCE_TYPE: {$9}, COMPUTERESOURCE_NAME: {$10}, DATACENTER_ID: {$11}, DATACENTER_NAME: {$12}, DATASTORE_ID: {$13}, DATASTORE_NAME: {$14}, NETWORK_ID: {$15}, NETWORK_NAME: {$16}, NETWORK_TYPE: {$17}, DVS_ID: {$18}, DVS_NAME: {$19}, CHANGE_TAG_ID: {$20}
 
