# Alienvault plugin
# Author: Fatih usta <fatihusta@labrisnetworks.com>
# Plugin openvpn id:91126 version: 0.0.1
# Last modification: 2018-11-08 10:00
#
# Plugin Selection Info:
# openvpn:-
#
# END-HEADER
#
# Description:
#   openvpn
#
#
#
#
 
[DEFAULT]
plugin_id=91126
 
[config]
type=detector
enable=yes
 
source=log
location=/var/log/openvpn-server.log
 
create_file=false
 
process=
start=no
stop=no
startup=
shutdown=

# Dec  5 16:28:51 hostname openvpn Fri Jul 13 09:38:24 2018 us=111111 111.111.123.111:1234 TLS: Initial packet from [AF_INET]111.111.111.111:12345, sid=9dasaxa4 9e1dddc
# Dec  5 16:25:13 hostname openvpn Mon Jul  2 08:13:57 2018 us=864111 11.111.111.111:1234 [xyzt] Peer Connection Initiated with [AF_INET]11.111.111.111:12345
# Dec  5 16:27:56 hostname openvpn Thu Jul  5 15:15:55 2018 us=12341234 xyzt/11.111.111.111:12345 SENT CONTROL [xyzt]: 'PUSH_REPLY,redirect-gateway def1 bypass-dhcp,dhcp-option DNS 11.11.11.11,dhcp-option DNS 11.11.11.11,route 11.11.11.11,topology net30,ping 10,ping-restart 120,ifconfig 11.11.11.11 22.22.22.22' (status=1)
# Dec  5 16:28:51 hostname openvpn Thu Jul 12 12:52:43 2018 us=12345 11.11.11.111:12345 Connection reset, restarting [-1]
# Dec  5 16:28:51 hostname openvpn Thu Jul 12 12:53:30 2018 us=123456 11.11.11.111:12345 SIGUSR1[soft,connection-reset] received, client-instance restarting

[0001 - openvpn-incoming connection]
event_type=event
regexp="\w+\s+\d+\s\d+:\d+:\d+\s(?P<device>.*?)\s(?P<sensor>.*?)\s(?P<date>\w+\s+\w+\s+\d+\s+\d{2}:\d{2}:\d{2}\s+\d{4})\s\S+\s([a-zA-Z@]+\/?)*(?P<src_ip>\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}):(?P<src_port>\d+)\s(?P<protocol>\S+):\sInitial packet from.*$"
date={normalize_date($date)}
device={$device}
plugin_sid=1
src_ip={$src_ip}
src_port={$src_port}
protocol={$protocol}

[0002 - openvpn-connection successfuly]
event_type=event
regexp="\w+\s+\d+\s+\d+:\d+:\d+\s(?P<device>.*?)\s(?P<sensor>.*?)\s(?P<date>\w+\s\w+\s+\d+\s+\d{2}:\d{2}:\d{2}\s\d{4})\s\S+\s([a-zA-Z@]+\/?)*(?P<src_ip>\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}):(?P<src_port>\d+).*Peer Connection Initiated.*$"
date={normalize_date($date)}
device={$device}
plugin_sid=2
src_ip={$src_ip}
src_port={$src_port}
protocol={$protocol}

[0003 - openvpn-client config push]
event_type=event
regexp="\w+\s+\d+\s\d+:\d+:\d+\s(?P<device>.*?)\s(?P<sensor>.*?)\s(?P<date>\w+\s\w+\s+\d+\s\d{2}:\d{2}:\d{2}\s\d{4})\s\S*\s([a-zA-Z@]+\/?)*(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):(?P<src_port>\d+)\sSENT\sCONTROL.*$"
date={normalize_date($date)}
device={$device}
plugin_sid=3
src_ip={$src_ip}
src_port={$src_port}
protocol={$protocol}

[0004 - openvpn-disconnect]
event_type=event
regexp="\w+\s+\d+\s\d+:\d+:\d+\s(?P<device>.*?)\s(?P<sensor>.*?)\s(?P<date>\w+\s\w+\s\d+\s\d{2}:\d{2}:\d{2}\s\d{4})\s\S*\s([a-zA-Z@]+\/?)*(?P<src_ip>\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}):(?P<src_port>\d+)\s.*reset.*$"
date={normalize_date($date)}
device={$device}
plugin_sid=4
src_ip={$src_ip}
src_port={$src_port}
protocol={$protocol}

[0005 - openvpn-soft reset]
event_type=event
regexp="\w+\s+\d+\s\d+:\d+:\d+\s(?P<device>.*?)\s(?P<sensor>.*?)\s(?P<date>\w+\s\w+\s\d+\s\d{2}:\d{2}:\d{2}\s\d{4})\s\S*\s([a-zA-Z@]+\/?)*(?P<src_ip>\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}):(?P<src_port>\d+)\s.*soft.*restarting.*"
date={normalize_date($date)}
device={$device}
plugin_sid=5
src_ip={$src_ip}
src_port={$src_port}
protocol={$protocol}
