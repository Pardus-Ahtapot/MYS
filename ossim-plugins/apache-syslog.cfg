# Alienvault plugin
# Author: Alienvault Team at plugins@alienvault.com
# Plugin apache-syslog id:1501 version: 0.0.4
# Last modification: 2017-12-04 16:00
#
# Plugin Selection Info:
# Apache Software Foundation:Apache HTTP Server:Syslog
#
# END-HEADER
# Accepted products:
# apache - http_server 0.8.11
# apache - http_server 0.8.14
# apache - http_server 1.0
# apache - http_server 1.0.2
# apache - http_server 1.0.3
# apache - http_server 1.0.5
# apache - http_server 1.1
# apache - http_server 1.1.1
# apache - http_server 1.2
# apache - http_server 1.2.4
# apache - http_server 1.2.5
# apache - http_server 1.2.6
# apache - http_server 1.2.9
# apache - http_server 1.3
# apache - http_server 1.3.0
# apache - http_server 1.3.1
# apache - http_server 1.3.1.1
# apache - http_server 1.3.10
# apache - http_server 1.3.11
# apache - http_server 1.3.12
# apache - http_server 1.3.13
# apache - http_server 1.3.14
# apache - http_server 1.3.15
# apache - http_server 1.3.16
# apache - http_server 1.3.17
# apache - http_server 1.3.18
# apache - http_server 1.3.19
# apache - http_server 1.3.2
# apache - http_server 1.3.20
# apache - http_server 1.3.22
# apache - http_server 1.3.23
# apache - http_server 1.3.24
# apache - http_server 1.3.25
# apache - http_server 1.3.26
# apache - http_server 1.3.27
# apache - http_server 1.3.28
# apache - http_server 1.3.29
# apache - http_server 1.3.3
# apache - http_server 1.3.30
# apache - http_server 1.3.31
# apache - http_server 1.3.32
# apache - http_server 1.3.33
# apache - http_server 1.3.34
# apache - http_server 1.3.35
# apache - http_server 1.3.36
# apache - http_server 1.3.37
# apache - http_server 1.3.38
# apache - http_server 1.3.39
# apache - http_server 1.3.4
# apache - http_server 1.3.41
# apache - http_server 1.3.42
# apache - http_server 1.3.5
# apache - http_server 1.3.6
# apache - http_server 1.3.65
# apache - http_server 1.3.68
# apache - http_server 1.3.7
# apache - http_server 1.3.8
# apache - http_server 1.3.9
# apache - http_server 1.4.0
# apache - http_server 1.99
# apache - http_server 2.0
# apache - http_server 2.0.28
# apache - http_server 2.0.32
# apache - http_server 2.0.34
# apache - http_server 2.0.35
# apache - http_server 2.0.36
# apache - http_server 2.0.37
# apache - http_server 2.0.38
# apache - http_server 2.0.39
# apache - http_server 2.0.40
# apache - http_server 2.0.41
# apache - http_server 2.0.42
# apache - http_server 2.0.43
# apache - http_server 2.0.44
# apache - http_server 2.0.45
# apache - http_server 2.0.46
# apache - http_server 2.0.47
# apache - http_server 2.0.48
# apache - http_server 2.0.49
# apache - http_server 2.0.50
# apache - http_server 2.0.51
# apache - http_server 2.0.52
# apache - http_server 2.0.53
# apache - http_server 2.0.54
# apache - http_server 2.0.55
# apache - http_server 2.0.56
# apache - http_server 2.0.57
# apache - http_server 2.0.58
# apache - http_server 2.0.59
# apache - http_server 2.0.60
# apache - http_server 2.0.61
# apache - http_server 2.0.63
# apache - http_server 2.0.64
# apache - http_server 2.0.9
# apache - http_server 2.1
# apache - http_server 2.1.1
# apache - http_server 2.1.2
# apache - http_server 2.1.3
# apache - http_server 2.1.4
# apache - http_server 2.1.5
# apache - http_server 2.1.6
# apache - http_server 2.1.7
# apache - http_server 2.1.8
# apache - http_server 2.1.9
# apache - http_server 2.2
# apache - http_server 2.2.0
# apache - http_server 2.2.1
# apache - http_server 2.2.10
# apache - http_server 2.2.11
# apache - http_server 2.2.12
# apache - http_server 2.2.13
# apache - http_server 2.2.14
# apache - http_server 2.2.15
# apache - http_server 2.2.16
# apache - http_server 2.2.17
# apache - http_server 2.2.18
# apache - http_server 2.2.19
# apache - http_server 2.2.2
# apache - http_server 2.2.20
# apache - http_server 2.2.21
# apache - http_server 2.2.22
# apache - http_server 2.2.23
# apache - http_server 2.2.3
# apache - http_server 2.2.4
# apache - http_server 2.2.5
# apache - http_server 2.2.6
# apache - http_server 2.2.8
# apache - http_server 2.2.9
# apache - http_server 2.3.0
# apache - http_server 2.3.1
# apache - http_server 2.3.10
# apache - http_server 2.3.11
# apache - http_server 2.3.12
# apache - http_server 2.3.13
# apache - http_server 2.3.14
# apache - http_server 2.3.15
# apache - http_server 2.3.16
# apache - http_server 2.3.2
# apache - http_server 2.3.3
# apache - http_server 2.3.4
# apache - http_server 2.3.5
# apache - http_server 2.3.6
# apache - http_server 2.3.7
# apache - http_server 2.3.8
# apache - http_server 2.3.9
# apache - http_server 2.4.0
# apache - http_server 2.4.1
# apache - http_server 2.4.2
# apache - http_server 2.4.3
# apache - http_server 3.1
# Description:
# Syslog version
#
#

[DEFAULT]
plugin_id=1501

dst_ip=\_CFG(plugin-defaults,sensor)
dst_port=80

[config]
type=detector
enable=yes

source=log
location=/var/log/syslog

create_file=false

process=apache2
start=yes
stop=no
startup=/etc/init.d/%(process)s start
shutdown=/etc/init.d/%(process)s stop

exclude_sids=200

[translation]
emerg=1
alert=2
crit=3
error=4
warn=5
notice=6
info=7
debug=8

_DEFAULT_ = 20000000


[0001 - apache-syslog-access]
event_type=event
regexp="\w{3}\s+\d{1,2} \d\d:\d\d:\d\d (?P<device>\S+) \S+: ((?P<dst>\S+)(:(?P<port>\d{1,5}))? )?(?P<src>\S+) (?P<id>\S+) (?P<user>\S+) \[(?P<date>\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2})\s+[+-]\d{4}\] \"(?P<request>.*)\" (?P<code>\d{3}) ((?P<size>\d+)|-)( \"(?P<referer_uri>.*)\" \"(?P<useragent>.*)\")?"
src_ip={$src}
dst_ip={$dst}
dst_port={$port}
device={$device}
date={normalize_date($date)}
plugin_sid={$code}
username={$user}
userdata1={$request}
userdata2={$size}
userdata3={$referer_uri}
userdata4={$useragent}
filename={$id}

[0002 - apache-syslog-error]
event_type=event
regexp=^(?P<date>\w{3}\s+\d{1,2} \d\d:\d\d:\d\d) (?P<device>\S+) \S+: \[(?P<type>(emerg|alert|crit|error|warn|notice|info|debug))\] (\[client (?P<src>\S+)\] )?(?P<data>.*)
date={normalize_date($date)}
dst_ip={$device}
device={$device}
plugin_sid={translate($type)}
src_ip={$src}
userdata1={$data}

[9999 - apache-syslog Generic Rule]
event_type=event
regexp="(?P<date>\w{3}\s+\d{1,2} \d\d:\d\d:\d\d) (?P<device>\S+).*"
date={normalize_date($date)}
device={$device}
plugin_sid=20000000