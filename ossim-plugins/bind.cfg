# Alienvault plugin
# Author: Alienvault Team at plugins@alienvault.com
# Plugin bind id:1577 version: 0.0.5
# Last modification: 2018-03-06 11:00
#
# Plugin Selection Info:
# ISC:BIND:-
#
# END-HEADER
# Accepted products:
# isc - bind 9.9.3
# Description:
#
#
#

[DEFAULT]
plugin_id=1577

[config]
type=detector
enable=true
source=log
location=/var/log/bind.log
create_file=true

process=rsyslog
start=no
stop=no
startup=
shutdown=

[translation]
xfer-in=1024
in cname=56
deleting rrset at=48
in a6=52
in soa=68
in naptr=64
name not in use=49
ended=75
dispatch=1013
notify=1018
in srv=69
in ds=58
lame-servers=1016
dnssec=1014
in ixfr=61
in ptr=66
unmatched=1021
in ns=65
client=1008
received notify=79
in a=51
update-security=1023
adding an rr at=46
delegation-only=1012
rrset exists (value dependent)=50
started=74
update=1022
in spf=81
resolver=1019
in dnskey=57
notify question=77
general=78
deleting an rr=47
network=1017
in hinfo=59
xfer-out=1025
in rrsig=67
database=1010
default=1011
config=1009
in mailb=62
in mx=63
in any=54
in axfr=55
queries=1007
security=1020
in txt=70
in aaaa=53
ch txt=71
denied=82
ANY TKEY=83
#   rule 63
chase DS servers = 88
connection refused = 89
malformed transaction = 1026
Read the configuration for the zone = 1027
Unable to modify RRSet = 1028
NWDSModifyObject failed while modifying an attribute = 1029
Transfer started = 42
transferred serial = 1024
sending notifies = 45
update unsuccessful = 1030
error sending = 1031
loaded serial = 78
Zone has been reloaded = 1032
Starting Data consolidation = 1033
SOA & JLA has been written in to eDirectory = 1034
NOTIFY failed = 1035
stopping command channel on = 1036
no longer listening on = 1037
Expired zone = 1038
AXFR-style IXFR ended = 43
AXFR-style IXFR started = 42

no valid signature found = 2001
exceeded = 2002
NODATA response = 2004
bad cache hit = 2005
verify failed due to bad signature = 2001
IN TYPE99 = 2006
got insecure response = 2007
#   DEFAULT
_DEFAULT_ = 20000000

[0001 - bind-updating-zone]
event_type=event
precheck="updating zone"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.+client\s+(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})#(?P<src_port>\d+):\s+updating zone\s+'(?P<zone>\S+)':\s+(?P<type>adding\san\sRR\sat|deleting\san\sRR|deleting\srrset\sat|update unsuccessful)\s*'?(?P<reg>[^'\s]+)?'?\s*(?P<regtype>\S+)?"
date={normalize_date($syslog_date)}
plugin_sid={translate($type)}
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$reg}
userdata2={$regtype}
userdata3={$zone}

[0002 - Bind AXFR-style]
event_type=event
precheck="AXFR-style"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]: client (?P<src_ip>\S+)#(?P<src_port>\d+): transfer of '(?P<zone>[^']+)': (?P<sid>AXFR-style IXFR (?:ended|started))"
date={normalize_date($syslog_date)}
plugin_sid={translate($sid)}
device={$syslog_dst}
dst_ip={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
userdata1={$zone}

[0003 - bind-RFC1918-response]
event_type=event
precheck="RFC 1918"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+) named[^\[]*\[\d+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*?client\s*(?P<dst_ip>\d+\.\d+\.\d+\.\d+)#(?P<dst_port>\d+):.*?RFC\s*1918\s*response\s*from\s*\S+\s*for\s*(?P<query_domain>\S*)"
date={normalize_date($syslog_date)}
plugin_sid=1003
device={$syslog_dst}
dst_ip={$dst_ip}
dst_port={$dst_port}
userdata1={$query_domain}

[0004 - bind-security]
event_type=event
precheck="security:"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s+security: (?P<level>\w+):?\s+client\s+(?P<src_ip>\d+.\d+.\d+.\d+)\#(?P<src_port>\d+):\s*query\s*\'(?P<query>.*)\'.+"
date={normalize_date($syslog_date)}
plugin_sid=72
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$level}
userdata2={$query}

[0005 - bind-network]
event_type=event
precheck="network:"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s+network:\s+(?P<level>\w+):\s+(?P<info>.*?(?P<iface>interface \S+))\,\s+(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\#(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=73
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$level}
userdata2={$iface}

[0006 - bind-xfer-out]
event_type=event
precheck="xfer-out:"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s+xfer-out:\s+(?P<level>\w+):\s+client\s+(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\#(?P<src_port>\d{1,5}):\stransfer\sof\s\'(?P<domain_name>\S+)\':.*\wXFR\s(?P<status>\w+).*"
date={normalize_date($syslog_date)}
plugin_sid={translate($status)}
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$level}
userdata2={$domain_name}

[0007 - bind-xfer-out-bad-zone-transfer]
event_type=event
precheck="bad zone transfer request:"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*client\s(?:(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?P<src_ipv6>[^#]+))\#(?P<src_port>\d+)(?:\s\((?P<domain>[^)]+)\))?: bad zone transfer request: '(?P<domain_name>\S+)'.*"
date={normalize_date($syslog_date)}
plugin_sid=80
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$domain_name}
userdata2={$src_ipv6}
userdata3={$domain}

# Jul 29 21:36:45 <> named-sdb[23132]: client 1.1.1.1#52766: update '<name>' denied
# Feb 25 00:02:21 device named[28355]: client 1:1:1::1:1#63928: update forwarding '<name>' denied
[0008 - update allowed/denied]
event_type=event
precheck="update"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s(?:named[^\[]*)?\[\S+\]:\s*client\s*(?:(?P<src_ip>\d+\.\d+\.\d+\.\d+)|(?P<src_ipv6>[^#]*))#(?P<src_port>\d+):\s*update(?:\sforwarding)?\s'(?P<module>[^']*)'\s*(?P<status>denied|allowe?d?)"
date={normalize_date($syslog_date)}
plugin_sid=84
device={$syslog_dst}
src_ip={$src_ip}
dst_ip={$syslog_dst}
src_port={$src_port}
userdata1={$module}
userdata2={$status}
userdata3={$src_ipv6}

[0009 - bind zone-transfer-failed]
event_type=event
precheck="failed while receiving responses:"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*transfer of\s+'(?P<info>\S+)'\sfrom\s+(?P<src_ip>\d+.\d+.\d+.\d+)\#(?P<src_port>\d+):\s+failed while receiving responses: (?P<code>REFUSED|unexpected error|\(result code text not available\))"
date={normalize_date($syslog_date)}
plugin_sid=44
device={$syslog_dst}
src_port={$src_port}
src_ip={$src_ip}
dst_ip={$syslog_dst}
userdata1={$info}
userdata2={$code}

[0010 - bind-success-afxr]
event_type=event
precheck="approved AXFR from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*approved AXFR from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)(?: for (?P<domain>\S+))?"
date={normalize_date($syslog_date)}
plugin_sid=1
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$domain}

[0011 - bind-bad-referal]
event_type=event
precheck="bad referral"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*bad referral\s+\((?P<info>.*)\)\s+(from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+))?"
date={normalize_date($syslog_date)}
plugin_sid=2
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$info}

[0012 - bind-bad-response]
event_type=event
precheck="bad response"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*bad response .+ from (?P<src_ip>\d+.\d+.\d+.\d+)(?:, zone (?P<domain>[^)\s]+).*)?"
date={normalize_date($syslog_date)}
plugin_sid=3
device={$syslog_dst}
src_ip={$src_ip}
dst_ip={$syslog_dst}
userdata1={$domain}

[0013 - bind-interface-deleted]
event_type=event
precheck="deleting interface"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*deleting interface \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=4
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}

[0014 - bind-denied-axfr]
event_type=event
precheck="denied AXFR from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*denied AXFR from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)(?: for \"(?P<domain>[^"]+)\")?"
date={normalize_date($syslog_date)}
plugin_sid=5
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$domain}

[0015 - bind-denied-update]
event_type=event
precheck="denied update from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*denied update from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)(?: for \"\s*(?P<domain>[^"]+))?"
date={normalize_date($syslog_date)}
plugin_sid=6
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$domain}

[0016 - bind-drop-srcport-zero]
event_type=event
precheck="dropping source port zero packet"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*dropping source port zero packet from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=7
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}

[0017 - bind-error-update]
event_type=event
precheck="error processing update packet"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*error processing update packet .+ from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=8
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}

[0018 - bind-tcp-connection]
event_type=event
precheck="TCP connection from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*IP\/TCP connection from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=9
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}

[0019 - bind-lame-server]
event_type=event
precheck="Lame server on"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*Lame server on '(?P<server>[^']+)' \((?:[^)]+)\):\s*\[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)\s*(?:'(?P<domain>[^']+)')?"
date={normalize_date($syslog_date)}
plugin_sid=10
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$server}
userdata2={$domain}

[0020 - bind-malformed-response]
event_type=event
precheck="Malformed response from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*Malformed response from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=11
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0021 - bind-unknown-class]
event_type=event
precheck="no matching view in class"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*client (?P<src_ip>\d+.\d+.\d+.\d+)\#(?P<src_port>\d+):\s*no matching view in class (?:'(?P<class>[^']+)'|.+)"
date={normalize_date($syslog_date)}
plugin_sid=12
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$class}

[0022 - bind-forward-op-not-permitted]
event_type=event
precheck="Operation not permitted"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: sendto\(\[?(?P<dst_ip>\d+.\d+.\d+.\d+)\]?\.(?P<dst_port>\d+)\): Operation not permitted"
date={normalize_date($syslog_date)}
plugin_sid=17
dst_ip={$dst_ip}
dst_port={$dst_port}
src_ip={$syslog_dst}
device={$syslog_dst}

[0023 - bind-forward-resource-unavailable]
event_type=event
precheck="Resource temporarily unavailable"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: sendto\(\[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)\): Resource temporarily unavailable"
date={normalize_date($syslog_date)}
plugin_sid=18
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0024 - bind-request-no-buffer]
event_type=event
precheck="No buffer space available"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: sendto\(\[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)\): No buffer space available"
date={normalize_date($syslog_date)}
plugin_sid=20
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0025 - bind-bogus-loopback]
event_type=event
precheck="Bogus LOOPBACK"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: query\((?P<src_ip>\S+)\) Bogus LOOPBACK\s*(?:.*?learnt \((?P<info>[^)]+)\))?"
date={normalize_date($syslog_date)}
plugin_sid=23
src_ip={$src_ip}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$info}

[0026 - bind-server-name-mismatch]
event_type=event
precheck="server name mismatch"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: server name mismatch for \[(?P<dst_ip>\d+.\d+.\d+.\d+)\]: (?:\([^)]+\))? (?:\(server for (?P<server>[^)\s]+))?"
date={normalize_date($syslog_date)}
plugin_sid=25
dst_ip={$dst_ip}
src_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$server}

[0027 - bind-tcp-truncated]
event_type=event
precheck="TCP truncated:"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: TCP truncated: \"(?P<src_ip>\S+)\" .*"
date={normalize_date($syslog_date)}
plugin_sid=26
src_ip={$src_ip}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0028 - bind-zone-transfer-restricted]
event_type=event
precheck="record too short from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*record too short from \[?(?P<src_ip>\d+\.\d+\.\d+\.\d+)\]?, zone (?P<domain>\S+)"
date={normalize_date($syslog_date)}
plugin_sid=27
src_ip={$src_ip}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0029 - bind-query-on-non-query-socket]
event_type=event
precheck="refused query on non-query socket"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*refused query on non-query socket from \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=28
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0030 - bind-response-unexpected]
event_type=event
precheck="esponse from unexpected source"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*[Rr]esponse from unexpected source \(\[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)\)"
date={normalize_date($syslog_date)}
plugin_sid=29
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0031 - bind-response-badtime]
event_type=event
precheck="BADTIME"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*SOA TSIG verification from server \[(?P<src_ip>\d+.\d+.\d+.\d+)\](?:, zone (?P<zone>[^:]+):.+|.+)BADTIME"
date={normalize_date($syslog_date)}
plugin_sid=30
src_ip={$src_ip}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$zone}

[0032 - bind-unapproved-recursive]
event_type=event
precheck="unapproved recursive query from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*unapproved recursive query from \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)(?: for (?P<domain>\S+)|.+)"
date={normalize_date($syslog_date)}
plugin_sid=35
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0033 - bind-unapproved-update]
event_type=event
precheck="unapproved update from"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*unapproved update from \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)(?: for (?P<domain>\S+)|.+)"
date={normalize_date($syslog_date)}
plugin_sid=36
src_port={$src_port}
src_ip={$src_ip}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0034 - bind unrelated-info]
event_type=event
precheck="unrelated additional info"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*unrelated additional info (?:'(?P<domain>[^']+)')? .+ \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=37
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0035 - bind-zone-transfer-timeout]
event_type=event
precheck="zone transfer timeout"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*zone transfer timeout for \"?(?P<domain>[^"\s]+)\"?.+"
date={normalize_date($syslog_date)}
plugin_sid=39
dst_ip={$syslog_dst}
userdata1={$domain}
device={$syslog_dst}

[0036 - bind-too-many-timeouts]
event_type=event
precheck="too many timeouts"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*too many timeouts resolving '(?P<query_domain>[^']*)'\s*\(in\s+'(?P<top_domain>[^']*)"
date={normalize_date($syslog_date)}
plugin_sid=1000
dst_ip={$syslog_dst}
userdata3={$query_domain}
userdata4={$top_domain}
device={$syslog_dst}

[0037 - bind-FORMERR-resolving]
event_type=event
precheck="FORMERR"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*\(?FORMERR\)?\s*resolving\s*'(?P<query_domain>[^']*)':\s+(?P<dst_ip>\d+\.\d+\.\d+\.\d+)#(?P<dst_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=1002
dst_ip={$dst_ip}
dst_port={$dst_port}
userdata3={$query_domain}
device={$syslog_dst}

# Feb 25 10:22:36 <device> named[60700]: checkhints: <query_domain> (1.1.1.1) missing from hints
[0038 - bind-checkhints]
event_type=event
precheck="checkhints:"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?(?:.+general: (?P<level>[^:]+):)?\s*checkhints:\s+(?P<query_domain>\S+)\s+\((?P<dst_ip>\S+)\).*hints"
date={normalize_date($syslog_date)}
plugin_sid=1004
dst_ip={$dst_ip}
userdata2={$level}
userdata3={$query_domain}
device={$syslog_dst}

[0039 - bind-lame-server-resolving]
event_type=event
precheck="lame server resolving"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.+(?:(?P<level>[^:]+):)?\s*lame server resolving '(?P<query_domain>[^']*)'\s*\(in\s+'(?P<top_domain>[^']*)'\?*\):?\s*(?:(?P<src_ip>\S+)#(?P<src_port>\d+))"
date={normalize_date($syslog_date)}
device={$syslog_dst}
dst_ip={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
plugin_sid=1006
userdata2={$level}
userdata3={$query_domain}
userdata4={$top_domain}

# Jul 29 21:33:12 <> named-sdb[32689]: clients-per-query decreased/increased to ##
[0040 - Bind - clients increase/decrease]
event_type=event
precheck="clients-per-query"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+) named[^\[]*\[\d+\]:\s*clients-per-query\s(?P<limit>decreased|increased)\s*to\s*(?P<c_number>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=85
device={$syslog_dst}
userdata1={$limit}
userdata2={$c_number}

# Jul 29 21:33:12 <> named-sdb[32689]: managed-keys-zone ./IN: No DNSKEY RRSIGs found for '----': success
[0041 - Bind - managed-keys-zone]
event_type=event
precheck="managed-keys-zone"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+) named[^\[]*\[\d+\]:\s*managed-keys-zone\s*(?P<zone>\S+)\s*No DNSKEY RRSIGs found for '(?P<route>[^']*)':\s*(?P<result>\S+)"
date={normalize_date($syslog_date)}
plugin_sid=86
device={$syslog_dst}
userdata1={$zone}
userdata2={$route}
userdata3={$result}

# Jul 31 04:37:36 <> named-sdb[32689]: zone ---: refresh: could not set file modification time of '-----': permission denied
[0042 - Bind - permission denied]
event_type=event
precheck="could not set file modification time"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+) named[^\[]*\[\d+\]:\s*zone (?P<zone>\S+):\s*(?P<action>\S+):\s*could not set file modification time of\s*'(?P<route>[^']*)':\s*(?P<permission>.*)"
date={normalize_date($syslog_date)}
plugin_sid=87
device={$syslog_dst}
userdata1={$zone}
userdata2={$action}
userdata3={$route}
userdata4={$permission}

# Feb 25 03:01:41 device named[60700]: client 1.1.1.1#1234 (something.com): rpz QNAME Local-Data rewrite something.com via something.com.rpz-something
[0043 - Bind - RPZ Rewrite events]
event_type=event
precheck="rpz QNAME Local-Data rewrite"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s+client\s*(?P<src_ip>\d+\.\d+\.\d+\.\d+)#(?P<src_port>\d+)\s\((?P<server>[^)]+)\):\srpz\sQNAME\sLocal-Data\srewrite\s(?P<rpz_orig>\S+)\svia\s(?P<rpz_new>\S+)"
date={normalize_date($syslog_date)}
plugin_sid=2000
device={$syslog_dst}
dst_ip={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
userdata1={$server}
userdata2={$rpz_orig}
userdata3={$rpz_new}

# Feb 25 00:02:20 1.1.1.1 named[28418]: zone 1.1.1.in-addr.arpa/IN: refresh: retry limit for master 2.2.2.2#1234 exceeded (source 0.0.0.0#0)
[0044 - Bind - Retry Limit]
event_type=event
precheck="retry limit for master"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*zone (?P<zone>\S+):\s*refresh:\s*retry\slimit\sfor\smaster\s(?P<dst>[^#]+)#(?P<dst_port>\d+)\s(?P<sid>exceeded)\s\(source\s(?P<src_ip>[^#]+)#(?P<src_port>\d+)\)"
date={normalize_date($syslog_date)}
plugin_sid={translate($sid)}
device={$syslog_dst}
dst_ip={$dst}
dst_port={$dst_port}
src_ip={$src_ip}
src_port={$src_port}
userdata1={$zone}


# Feb 25 11:51:01 <device> named[28355]: client 1.1.1.1#11111 (<zone>): error sending response: connection reset
[0045 - Bind - Error sending response]
event_type=event
precheck="error sending response"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s+client\s*(?P<src_ip>\d+\.\d+\.\d+\.\d+)#(?P<src_port>\d+)\s\((?P<server>[^)]+)\):\serror\ssending\sresponse:\s(?P<reason>.+)"
date={normalize_date($syslog_date)}
plugin_sid=1031
device={$syslog_dst}
dst_ip={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
userdata1={$server}
userdata2={$reason}

# Feb 25 15:59:51 1.1.1.1 named[28418]: zone <zone>: zone transfer deferred due to quota
[0046 - Bind - Zone transfer deferred due to quota]
event_type=event
precheck="zone transfer deferred due to quota"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*zone\s(?P<zone>[^:]+):\szone transfer deferred due to quota"
date={normalize_date($syslog_date)}
plugin_sid=2008
device={$syslog_dst}
src_ip={$syslog_dst}
userdata1={$zone}

#Feb 25 00:05:52 1.1.1.1 named[28418]: zone <zone>: refresh: unexpected rcode (REFUSED) from master 1.1.1.1#1234 (source 0.0.0.0#0)
#Jun  9 18:32:50 device named[2082]: unexpected RCODE (SERVFAIL) resolving '1.1.1.1.in-addr.arpa/PTR/IN': 1.1.1.1#53
[0047 - bind-unexpected-RCODE]
event_type=event
#precheck="RCODE"
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s(?:named[^\[]*)?\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.+?(?:(?P<level>[^:]+):)?(?:\srefresh:)?\s*\(?unexpected\s*RCODE\s*\(?(?P<rcode>.*?)\)\s*(?:resolving\s*'(?P<query_domain>[^']*)':|from master)?\s+(?P<dst_ip>\d+\.\d+\.\d+\.\d+)#(?P<dst_port>\d+)(?:\s\(source\s(?P<src_ip>[^#]+)#(?P<src_port>\d+)\))?"
date={normalize_date($syslog_date)}
plugin_sid=1005
device={$syslog_dst}
dst_ip={$dst_ip}
dst_port={$dst_port}
src_ip={$src_ip}
src_port={$src_port}
userdata2={$level}
userdata3={$query_domain}
userdata5={$rcode}

[0048 - bind-query-types ]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-sdb)?)?\s*\[\S+\]:\s*(?:(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s+queries:\s(?P<level>\w+):\s+)?client\s+(?P<src_ip>\d+.\d+.\d+.\d+)\#(?P<src_port>\d+):\s+query(?:: |\s*')(?P<query_domain>[^'\s]*)'?\s+(?P<query_type>denied|\S+\s\S+)(?:.*?\((?P<ip_domain>\d+.\d+.\d+.\d+)\))?"
date={normalize_date($syslog_date)}
plugin_sid={translate($query_type)}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$level}
userdata2={$query_domain}
userdata3={$ip_domain}

[0049 - Bind Zone Generic Event]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*(?:notify: (?P<level>\w+):?\s+)?zone (?P<zone>\S+):(?:\srefresh:)?\s*(?P<sid>sending notifies|transferred serial|Transfer started|notify|loaded serial|Zone has been reloaded|Starting Data consolidation|SOA & JLA has been written in to eDirectory|Expired zone|NODATA response)(?:\sfrom(?:\smaster)?\s(?P<src_ip>\S+)#(?P<src_port>\d+))?.*"
date={normalize_date($syslog_date)}
plugin_sid={translate($sid)}
device={$syslog_dst}
dst_ip={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
userdata1={$level}
userdata2={$zone}

#Feb 25 02:51:07 device named[28355]: client 1.1.1.1#1111/key <somekey>: received notify for zone '<zone>': TSIG '<zone>'
#Sep 28 00:11:48 device [NCPL]: client 1.1.1.1#11111: received notify for zone '<zone>'
[0050 - bind-notify-question]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*(?:notify:\s+(?P<level>\w+):)?\s+client (?:(?P<src_ip>\d+.\d+.\d+.\d+)|(?P<ipv6>\S+))#(?P<src_port>\d+)(?:/key\s(?P<key>[^:]+))?:\s+(?P<psid>\w+\s\w+)(\sfor zone\s'(?P<zone>[^']+)')?"
date={normalize_date($syslog_date)}
plugin_sid={translate($psid)}
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$level}
userdata2={$zone}
userdata3={$key}
userdata4={$ipv6}

[0051 - bind-xfer-in]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*(?:xfer-in:\s+(?P<level>\w+):\s+)?transfer of '(?P<domain>\S+)' from (?P<src_ip>\d+.\d+.\d+.\d+)#(?P<src_port>\d+):(?: connected using (?P<ip>\S+)#(?P<port>\d+)|.*)"
date={normalize_date($syslog_date)}
plugin_sid=1024
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$level}
userdata2={$domain}
userdata3={$ip}
userdata4={$port}

[0052 - bind-notify-soa-non-origin]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*NOTIFY\(SOA\) for non-origin\s*(?:\((?P<domain>[^)]+)\),)? from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=13
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0053 - bind-notify-soa-non-secondary]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*NOTIFY\(SOA\) for non-secondary name (?:\((?P<domain>[^)]+)\),|.+) from \[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=14
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

# Feb 25 17:16:11 <device> named[60700]: zone <zone>: refused notify from non-master: 1:1:0:1::1#12345
[0054 - bind-notify-soa-non-master]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*(?:zone (?P<domain>\S+):)?\s*(?:NOTIFY\(SOA\)|refused notify) from non-master:?\s*(?:server\s*(?:\(zone\s(?P<zone>[^)]+)\),)? from \[)?(?:(?P<src_ip>\d+.\d+.\d+.\d+)|(?P<ipv6>\S+))\]?(?:\.|#)(?P<src_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=15
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}
userdata2={$zone}
userdata3={$ipv6}

[0055 - bind-request-connection-refused ns_resp]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_resp: sendto\(\[?(?P<src_ip>\d+.\d+.\d+.\d+)\]?\.(?P<src_port>\d+)\): Connection refused"
date={normalize_date($syslog_date)}
plugin_sid=19
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0056 - bind-request-connection-refused ns_forw | ns_req]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_(forw|req): sendto\(\[?(?P<dst_ip>\d+.\d+.\d+.\d+)\]?\.(?P<dst_port>\d+)\): Connection refused"
date={normalize_date($syslog_date)}
plugin_sid=19
dst_ip={$dst_ip}
dst_port={$dst_port}
src_ip={$syslog_dst}
device={$syslog_dst}

[0057 - bind-response-unexisting-name-server]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: query\((?P<dst_ip>\S+)\) All possible .+ lame"
date={normalize_date($syslog_date)}
plugin_sid=21
dst_ip={$dst_ip}
src_ip={$syslog_dst}
device={$syslog_dst}

[0058 - bind-no-possible-record]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*ns_\S+: query\((?P<src_ip>\d+.\d+.\d+.\d+).in.+\) No possible A.+"
date={normalize_date($syslog_date)}
plugin_sid=24
src_ip={$src_ip}
dst_ip={$syslog_dst}
device={$syslog_dst}

[0059 - bind-zone-transfer-denied-acl]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*unapproved AXFR from \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)(?: for "(?P<domain>[^"]+)"|.+) \(acl\)"
date={normalize_date($syslog_date)}
plugin_sid=31
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0060 - bind-zone-transfer-denied-master]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*unapproved AXFR from \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)(?: for "?(?P<domain>[^"]+)"?|.+) \(not master.+\)"
date={normalize_date($syslog_date)}
plugin_sid=32
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0061 - bind-zone-transfer-denied-not-top]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*unapproved AXFR from \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)(?: for "(?P<domain>[^"]+)"|.+) \(not zone top\)"
date={normalize_date($syslog_date)}
plugin_sid=33
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0062 - bind-zone-transfer-denied-syntax]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*unapproved AXFR from \[(?P<src_ip>\d+.\d+.\d+.\d+)\].(?P<src_port>\d+)(?: for "(?P<domain>[^"]+)"|.+) \(not auth\)"
date={normalize_date($syslog_date)}
plugin_sid=34
src_port={$src_port}
src_ip={$src_ip}
dst_ip={$syslog_dst}
device={$syslog_dst}
userdata1={$domain}

[0063 - bind-zone-transfer-success]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*zone transfer \(AXFR\) of \"?(?P<domain>[^"\s]+)\"? .+ \[(?P<dst_ip>\d+.\d+.\d+.\d+)\].(?P<dst_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid=38
dst_port={$dst_port}
dst_ip={$dst_ip}
device={$syslog_dst}
userdata1={$domain}

[0064 - bind-name-server-unreachable]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*zoneref: Masters for secondary zone \"(?P<domain>\S+)\" unreachable"
date={normalize_date($syslog_date)}
plugin_sid=40
dst_ip={$syslog_dst}
userdata1={$domain}
device={$syslog_dst}

[0065 - bind secondary zone expired]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*secondary zone \"(?P<domain>\S+)\" expired"
date={normalize_date($syslog_date)}
plugin_sid=41
dst_ip={$syslog_dst}
userdata1={$domain}
device={$syslog_dst}

# Feb 25 10:17:53 <device>[60700]: client 1.1.1.1#1 (<domain>): query (cache) '<query_domain>' denied
# Oct 25 12:36:19 <device>[16263]: 25-Oct-2011 12:36:19.297 security: info: client 1.1.1.1#1: query (cache) '<query_domain>' denied
[0066 - bind-query-cache-denied]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?.*?client\s*(?:(?P<src_ip>\d+\.\d+\.\d+\.\d+)|(?P<ipv6>\S+))#(?P<src_port>\d+)(?:\s\((?P<server>\S+)\))?:\s*query \(cache\).*?'(?P<query_domain>[^']*)'\s*denied"
date={normalize_date($syslog_date)}
plugin_sid=1001
device={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$syslog_dst}
userdata1={$server}
userdata2={$ipv6}
userdata3={$query_domain}

# Jul 31 17:53:52 <> named-sdb[32689]: error (chase DS servers) resolving '<domain>': 1.1.1.1#53
# Jul 31 19:59:54 <> named-sdb[32689]: error (connection refused) resolving '<domain>': 1.1.1.1#53
[0067 - bind-error-chase/con_refused-resolving]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+) named[^\[]*\[\d+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*error\s*\(?(?P<sid>chase DS servers|connection refused)\)?\s*resolving\s*'(?P<query_domain>[^']*)':\s+(?P<dst_ip>\d+\.\d+\.\d+\.\d+)#(?P<dst_port>\d+)"
date={normalize_date($syslog_date)}
plugin_sid={translate($sid)}
device={$syslog_dst}
dst_ip={$dst_ip}
dst_port={$dst_port}
userdata1={$query_domain}

[0068 - Bind - Other events]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*(?P<sid>malformed transaction|Read the configuration for the zone|Unable to modify RRSet|NWDSModifyObject failed while modifying an attribute|stopping command channel on|no longer listening on)(?:\s\([^)]+\))?:?\s*(?:(?P<path>\S+) last serial \d+ != transaction first serial \d+|(?P<domain>\S+) of type: \d+ with return code: \d+|(?P<dns>\S+) with error (?P<code>\S+)|(?P<src_ip>\S+)#(?P<src_port>\d+))*"
date={normalize_date($syslog_date)}
plugin_sid={translate($sid)}
device={$syslog_dst}
dst_ip={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
filename={$path}
userdata1={$domain}
userdata2={$dns}
userdata3={$code}

#Feb 25 00:05:43 1.1.1.1 named[28418]: network unreachable resolving 'aaa.bbb.bbb.net/A/IN': 1:1:1::1#53
#Mar  1 10:27:38 device named[12006]: ns_forw: sendto([1.1.1.1].123): Network is unreachable
[0069 - bind-forward-net-unreachable]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*(?:(?P<date>\d{1,2}-\w{3}-\d{4} \d{2}:\d{2}:\d{2})\.\d+)?\s*(?:ns_\S+: sendto|network unreachable resolving)(?:\s'(?P<zone>[^']+)':\s)?(?:\(\[?)?(?:(?P<dst_ip>\d+.\d+.\d+.\d+)\]?|(?P<dst_ipv6>[^#]+))(?:\.|#)(?P<dst_port>\d+)\)?(?:: Network is unreachable)?"
date={normalize_date($syslog_date)}
plugin_sid=16
device={$syslog_dst}
src_ip={$syslog_dst}
dst_ip={$dst_ip}
dst_port={$dst_port}
userdata1={$dst_ipv6}
userdata2={$zone}

# Feb 25 03:01:41 device named[60700]: validating @0x1f111111d1e0: aaa.bbb.ccc.gov A: no valid signature found
# Feb 25 03:52:03 device named[60700]: validating @0x1f111111d1e0: blah.com DNSKEY: verify failed due to bad signature (keyid=11111): RRSIG has expired
# Feb 25 03:52:04 device named[60700]: validating @0x1f111111d1e0: blah.com A: bad cache hit (blah.com/DNSKEY)
[0070 - Bind - Validating signature]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d{1,2}:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s+validating\s(?P<signature>[^:]+):\s(?P<zone>[^:]+):\s(?P<sid>no valid signature found|bad cache hit|verify failed due to bad signature|got insecure response)\s*(?:\((?:keyid=(?P<keyid>[^)]+)|(?P<dnskey>[^)]+))\)(?::\s+(?P<msg>.+))?)?"
date={normalize_date($syslog_date)}
plugin_sid={translate($sid)}
device={$syslog_dst}
dst_ip={$syslog_dst}
userdata1={$signature}
userdata2={$zone}
userdata3={$keyid}
userdata4={$dnskey}
userdata5={$msg}

# Feb 25 00:05:40 device named[28355]: client 1:1:1:1:1:1:1:1#58685 (something): zone transfer 'somezone' denied
[0071 - Bind - Zone tranfer denied]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named(?:-xfer)?)?\s*\[\S+\]:\s*client\s(?:(?P<src_ip>\d+\.\d+\.\d+\.\d+)|(?P<src_ipv6>[^#]+))#(?P<src_port>\d+)\s\((?P<domain>[^)]+)\):\szone transfer\s'(?P<zone>[^']+)'\sdenied"
date={normalize_date($syslog_date)}
plugin_sid=2003
device={$syslog_dst}
dst_ip={$syslog_dst}
src_ip={$src_ip}
src_port={$src_port}
userdata1={$zone}
userdata2={$src_ipv6}
userdata3={$domain}


[9999 - Bind Generic Rule]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+(?P<syslog_dst>\S+)\s*(?:named)?\s*\[\S+\]:(?P<desc>.*)"
date={normalize_date($syslog_date)}
plugin_sid=20000000
device={$syslog_dst}
dst_ip={$syslog_dst}
userdata1={$desc}

